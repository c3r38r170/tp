<h1>Inicio</h1>

<p>Tus tokens: <b id="tokens">{{usuarioActual?.tokens}}</b></p>

<fieldset class="row card">
	<legend><h2>Administración de Tokens</h2></legend>

	<details class="col-12" open>
		<summary><h3>Envío de tokens</h3></summary>
		<form id=form-enviar (submit)="enviarTokens($event)">
			<fieldset class="row">
				<input
					type="number"
					name="form-enviar-cantidad"
					id="form-enviar-cantidad"
					step=1
					value=1
					min=1
					max={{usuarioActual?.tokens}}
					required
					class="col"
				>
				<select
					name="form-enviar-usuario"
					id="form-enviar-usuario"
					required
					class="col-8"
					(input)="actualizarAmigoSeleccionadoID($event)"
				>
					<option value="0" >Elegir destinatario</option>
					
					<option *ngFor="let usuario of amigosReales" value="{{usuario.ID}}">{{usuario.nombreCompleto}}</option>
					
				</select>
				<input
					class="col"
					type=submit
					value="Enviar tokens"
					id=form-enviar-submit
					[disabled]="!amigoSeleccionadoID"
					title="Debe elegir un usuario para enviarle tokens."
				>
			</fieldset>
		</form>
	</details>

	<ng-template [ngIf]="puedeGenerarTokens">
		<details class="col-12">
			<summary><h3>Generar tokens</h3></summary>
			<form id="form-generar" (submit)="generarTokens($event)">
				<fieldset class="row">
					<legend>Generar tokens</legend>
					<input
						type="number"
						name="form-generar-cantidad"
						id=""
						min=1
						step=1
						max={{CANTIDAD_MAXIMA_TOKENS_GENERADOS}}
						required
						placeholder="Cantidad de tokens"
						class="col"
					>
					<input type=submit value=Generar class="col-2">
					<p class="col-12">Tokens en circulación: <b id=tokens-circulando>{{tokensCirculando}}</b></p>
				</fieldset>
			</form>
		</details>
	</ng-template>

</fieldset>

<fieldset class="row card">
	<legend><h2>Administración de Amigos</h2></legend>

	<div id="amigos" class="col">
		
		<details>
			<summary>
				<h3>Invitaciones Recibidas</h3>
			</summary>
	
<!-- TODO Mensaje para cuando no hay nada. <em> o <i> -->
			<form *ngFor="let usuario of amigosEntrantes" (submit)="responder($event)" class="col-12 row">
				<input type="hidden" name="usuarioID" value="{{usuario.ID}}">
				<span class="col">{{usuario.nombreCompleto}}</span>
				<button type="submit" value="1" (click)="asignarNombreABoton($event)" class="fas fa-check col-2"></button>
				<button type="submit" value="0" (click)="asignarNombreABoton($event)" class="button error fas fa-ban col-2"></button>
			</form>
		</details>
		
		<details>
			<summary>
				<h3>Invitaciones Enviadas</h3>
			</summary>

<!-- TODO Mensaje para cuando no hay nada. <em> o <i> -->
			<form *ngFor="let usuario of amigosSalientes" (submit)="cancelar($event)" class="col-12 row">
				<input type="hidden" name="usuarioID" value="{{usuario.ID}}">
				<span class="col">{{usuario.nombreCompleto}}</span>
				<button type="submit" class="button error fas fa-xmark col-2"></button>
			</form>
		</details>
		
		<details>
			<summary>
				<h3>Amigos</h3>
			</summary>
		<!-- TODO para cada uno de estos, esconder si uno es el invitador o no... -->
			<form *ngFor="let usuario of amigosReales" (submit)="eliminar($event)" class="col-12 row">
				<input type="hidden" name="usuarioID" value="{{usuario.ID}}">
				<span class="col">{{usuario.nombreCompleto}}</span>
				<button type="submit" class="button error fas fa-trash-can col-2"></button>
			</form>
		</details>
		
	</div>

	<div id="invitaciones" class="col">
		<input type="text" (input)="busqueda($event)" placeholder="Busque por nombre">
		<ng-template [ngIf]="this.mostrarVacio">
			<span>No se han encontrado usuarios.</span>
		</ng-template>
		<fieldset id="resultados" class="row">
			<!-- TODO capturar el submit en el fieldset? -->
			
			<form *ngFor="let usuario of usuariosEncontrados" (submit)="invitar($event)" class="col-12 row">
				<input type="hidden" name="usuarioID" value="{{usuario.ID}}">
				<span class="col">{{usuario.nombreCompleto}}</span>
				<button type="submit" class="fas fa-plus col-2"></button>
			</form>
					
		</fieldset>
	</div>

</fieldset>

<ng-template [ngIf]="puedeGenerarUsuarios">
	<fieldset class="row card">
		<legend>
			<h2>Administración de usuarios</h2>
		</legend>
		
		<details class="col-12">
			<summary><h3>Crear usuario</h3></summary>

			<form id=form-crear (submit)="crearUsuario($event)">
				<label class="row">
					<span class="col-2 is-center">Nombre completo</span>
					<input type="text" name="nombreCompleto" placeholder="Nombre completo" required class="col">
				</label>
				<label class="row">
					<span class="col-2 is-center">DNI</span>
					<input type="number" name="DNI" placeholder="DNI" required class="col" min="0">
				</label>
				<label class="row">
					<span class="col-2 is-center">Nombre de usuario</span>
					<input type="text" name="nombreUsuario" placeholder="Nombre de usuario" required class="col">
				</label>
				<label class="row">
					<span class="col-2 is-center">Contraseña temporal</span>
					<input type="text" name="contrasenia" placeholder="Contraseña" required class="col">
				</label>
				<label class="row">
					<span class="col-2 is-center">Correo electrónico</span>
					<input type="email" name="correo" placeholder="Correo electrónico" required class="col">
				</label>
				<!-- ! No hay condicional, porque si esto se ve, el usuario tiene minimo permiso de crear usuarios -->
				<fieldset class="row">
					<legend>Permisos</legend>
					<label *ngFor="let permiso of usuarioActual.permisos" class="col-4 row">
						<input type="checkbox" name="permisoID" value="{{permiso.ID}}" [checked]="permiso.predeterminado">
						<span class="col">{{permiso.descripcion}}</span>
					</label>
				</fieldset>
				<div class="row">
					<input type="submit" value="Crear usuario" class="col-3">
				</div>
			</form>
		</details>

	</fieldset>
</ng-template>

<fieldset class="card">
	<legend>
		<h2>Administración de Perfil</h2>
	</legend>
	<div class="row">
		<div class="col-10"></div>
		<button class="col-2 button error" (click)="salir()">Cerrar Sesión</button>
	</div>
</fieldset>